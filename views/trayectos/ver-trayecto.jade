extend ../layouts/main
block content
	.container(ng-controller="VerTrayectoCtrl")
			.row
				.col-md-12.alertas
					.alert.alert-dismissable(ng-repeat="a in avisos", ng-class="{{ a.clase }}")
						button.cerrar-aviso.close(type="button", data-dismiss="alert", aria-hidden="true") &times;
						span.glyphicon.glyphicon-ok-sign 
						|  {{ a.texto }}
			.row
				.col-md-12
					h1 Trayecto
						small.pull-right
							a.btn.btn-primary(ng-click="unirmeTrayecto()", ng-hide="unido_trayecto")
								span.glyphicon.glyphicon-plus-sign
								|  Unirse A Trayecto
							a.btn.btn-danger(ng-click="salirTrayecto()", ng-show="unido_trayecto")
								span.glyphicon.glyphicon-remove
								|  Salir del Trayecto
					.row
						.col-md-8
							.panel.panel-default.trayecto-div
								.panel-heading Informacion del Trayecto
								.panel-body
									.row
										.col-md-6
											table.table
												tr
													th Nº Plazas
													td {{ trayecto.Num_plazas }} ({{ trayecto.libres }} libres)
												tr 
													th Fecha Salida
													td {{ trayecto.Fecha_time }}
												tr 
													th Hora Salida
													td {{ trayecto.hora_salida }}
												tr
													th Restricciones
													td 
														span(ng-repeat="(key, r) in trayecto.Restricciones")
															{{ 	key.replace('_', ' ').toUpperCase() }}
															br

													
										.col-md-6
											table.table
												tr
													th Precio/Plaza
													td {{ trayecto.Precio_plaza }} €
												tr 
													th Max. Espera
													td {{ trayecto.Tiempo_max_espera }} minuto(s)
												tr 
													th Tamaño max. del equipaje
													td {{ trayecto.Max_tamanyo_equipaje }}
												tr
													th Tipo Pasajero
													td 
														span(ng-repeat="(key, r) in trayecto.Tipo_pasajeros")
															{{ 	key.replace('_', ' ').toUpperCase() }}
															br

									.row
										.col-md-12
											h4 Observaciones
											p {{ trayecto.Observaciones }}
						.col-md-4
							.panel.panel-default.creador-div
								.panel-heading 
									span.glyphicon.glyphicon-user  
									|  Creador
								.panel-body 
									table.table
										tr
											th Nombre
											td Juan Perez
										tr 
											th Coche
											td Seat Leon Rojo
										tr 
											th Departamento
											td Informatica
							
			.row
				.col-md-12
					.panel.panel-default
						.panel-heading 
							span.glyphicon.glyphicon-road 
							|  Ruta
						.panel-body
							.row
								.col-md-6
									table.table
										tr 
											th Origen
											td {{ trayecto.Origen }}
								.col-md-6
									table.table
										tr 
											th Destino
											td {{ trayecto.Destino }}
							.row
								.col-md-12
									div#map(style="width: 100%; height: 400px")

block script
	script(src="/js/VerTrayectoCtrl.js")
	script.
		var scope;
		$(document).ready(function(){
			scope = angular.element('[ng-controller="VerTrayectoCtrl"]').scope();
			//- scope.current_user = "from_site";
			scope.current_user = !{ userId };
			scope.$apply();
			scope.getTrayecto('!{id_trayecto}');
			scope.$apply();

			$('.alertas').on('click', '.cerrar-aviso', function(e){
				e.preventDefault();
				scope.avisos = [];
				scope.$apply();
			});

			map.drawRoute({
				origin: scope.trayecto.Origen_lat_lng,
				destination: scope.trayecto.Destino_lat_lng,
				travelMode: 'driving',
				strokeColor: '#336699',
				strokeOpacity: 0.5,
				strokeWeight: 6
			});

			map.addMarker({
				lat: scope.trayecto.Origen_lat_lng[0],
				lng: scope.trayecto.Origen_lat_lng[1],
				icon: '/img/inicio.png'
			});

			map.addMarker({
				lat: scope.trayecto.Destino_lat_lng[0],
				lng: scope.trayecto.Destino_lat_lng[1],
				icon: '/img/meta_centro.png'
			});

			setTimeout(function(){
				var h = $('.trayecto-div').css('height');
				$('.creador-div').css('height', h);
			}, 180);
			
		});

		var map = new GMaps({
			div: '#map',
			lat: 39.481289,
			lng: -0.3425168
		});
